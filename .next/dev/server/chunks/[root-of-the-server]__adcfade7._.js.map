{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/hack/FinPath/src/models/User.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n    username: {\r\n        type: String,\r\n        required: true,\r\n        unique: true,\r\n        trim: true,\r\n        minlength: 3,\r\n    },\r\n    email: {\r\n        type: String,\r\n        required: true,\r\n        unique: true,\r\n        trim: true,\r\n        lowercase: true,\r\n    },\r\n    password: {\r\n        type: String,\r\n        required: true,\r\n        minlength: 6,\r\n    },\r\n    xp: {\r\n        type: Number,\r\n        default: 0,\r\n    },\r\n    level: {\r\n        type: Number,\r\n        default: 1,\r\n    },\r\n    completedLessons: {\r\n        type: [Number],\r\n        default: [],\r\n    },\r\n    currentLesson: {\r\n        type: Number,\r\n        default: 1,\r\n    },\r\n    badges: [\r\n        {\r\n            type: String,\r\n        },\r\n    ],\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now,\r\n    },\r\n});\r\n\r\n// Force model recompilation in dev to pick up schema changes\r\nif (process.env.NODE_ENV === 'development') {\r\n    delete mongoose.models.User;\r\n}\r\n\r\nexport default mongoose.models.User || mongoose.model('User', UserSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACnC,UAAU;QACN,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;QACN,WAAW;IACf;IACA,OAAO;QACH,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;QACN,WAAW;IACf;IACA,UAAU;QACN,MAAM;QACN,UAAU;QACV,WAAW;IACf;IACA,IAAI;QACA,MAAM;QACN,SAAS;IACb;IACA,OAAO;QACH,MAAM;QACN,SAAS;IACb;IACA,kBAAkB;QACd,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACf;IACA,eAAe;QACX,MAAM;QACN,SAAS;IACb;IACA,QAAQ;QACJ;YACI,MAAM;QACV;KACH;IACD,WAAW;QACP,MAAM;QACN,SAAS,KAAK,GAAG;IACrB;AACJ;AAEA,6DAA6D;AAC7D,wCAA4C;IACxC,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI;AAC/B;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///D:/hack/FinPath/src/lib/db.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGO_URI;\r\n\r\nif (!MONGODB_URI) {\r\n    throw new Error(\r\n        'Please define the MONGO_URI environment variable inside .env.local'\r\n    );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n    cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function connectDB() {\r\n    if (cached.conn) {\r\n        return cached.conn;\r\n    }\r\n\r\n    if (!cached.promise) {\r\n        const opts = {\r\n            bufferCommands: false,\r\n        };\r\n\r\n        cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\r\n            return mongoose;\r\n        });\r\n    }\r\n\r\n    try {\r\n        cached.conn = await cached.promise;\r\n    } catch (e) {\r\n        cached.promise = null;\r\n        throw e;\r\n    }\r\n\r\n    return cached.conn;\r\n}\r\n\r\nexport default connectDB;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,SAAS;AAEzC,IAAI,CAAC,aAAa;IACd,MAAM,IAAI,MACN;AAER;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACT,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACpE;AAEA,eAAe;IACX,IAAI,OAAO,IAAI,EAAE;QACb,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACjB,MAAM,OAAO;YACT,gBAAgB;QACpB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YACxD,OAAO;QACX;IACJ;IAEA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,GAAG;QACR,OAAO,OAAO,GAAG;QACjB,MAAM;IACV;IAEA,OAAO,OAAO,IAAI;AACtB;uCAEe"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///D:/hack/FinPath/src/app/api/user/progress_v2/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport User from '@/models/User';\r\nimport connectDB from '@/lib/db';\r\nimport jwt from 'jsonwebtoken';\r\n\r\n// Helper to get user from token (since we saw 'x-auth-token' in AuthContext)\r\nconst getUserFromRequest = async (req: Request) => {\r\n    const token = req.headers.get('x-auth-token');\r\n    if (!token) return null;\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET || 'fallback_secret');\r\n        return (decoded as any).user;\r\n    } catch (err) {\r\n        return null;\r\n    }\r\n};\r\n\r\nexport async function POST(req: Request) {\r\n    const logs: string[] = [];\r\n    const log = (...args: any[]) => {\r\n        console.log(...args);\r\n        logs.push(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '));\r\n    };\r\n\r\n    try {\r\n        await connectDB();\r\n\r\n        const userDecoded = await getUserFromRequest(req);\r\n        if (!userDecoded) {\r\n            return NextResponse.json({ msg: 'No token, authorization denied' }, { status: 401 });\r\n        }\r\n\r\n        log('Processing progress update request');\r\n        const body = await req.json();\r\n        log('Request body:', body);\r\n        const { lessonId, completed } = body;\r\n\r\n        log('Finding user with ID:', userDecoded.id);\r\n        const user = await User.findById(userDecoded.id);\r\n        if (!user) {\r\n            log('User not found');\r\n            return NextResponse.json({ msg: 'User not found' }, { status: 404 });\r\n        }\r\n\r\n        log('User found, updating progress');\r\n        log('User type:', typeof user);\r\n        log('Is user instance of model?', user instanceof User);\r\n\r\n        // Initialize fields if they don't exist (handling schema updates on existing docs)\r\n        // Use user.get() to safely access fields that might not be in the cached schema\r\n        let completedLessons;\r\n        try {\r\n            completedLessons = user.get('completedLessons');\r\n        } catch (e) {\r\n            log('Error getting completedLessons:', e);\r\n            completedLessons = undefined;\r\n        }\r\n\r\n        log('Initial completedLessons:', completedLessons);\r\n        log('Is Array?', Array.isArray(completedLessons));\r\n\r\n        if (!Array.isArray(completedLessons)) {\r\n            log('completedLessons is not an array, initializing');\r\n            completedLessons = [];\r\n            user.set('completedLessons', completedLessons, { strict: false });\r\n        }\r\n\r\n        let currentLesson = user.get('currentLesson');\r\n        if (currentLesson === undefined || currentLesson === null) {\r\n            currentLesson = 1;\r\n            user.set('currentLesson', currentLesson, { strict: false });\r\n        }\r\n\r\n        if (completed) {\r\n            log('Checking completion for lessonId:', lessonId);\r\n            log('completedLessons before check:', completedLessons);\r\n            log('Type of completedLessons:', typeof completedLessons);\r\n\r\n            if (!completedLessons.includes(lessonId)) {\r\n                completedLessons.push(lessonId);\r\n                // Need to set it back if we modified the array reference or if it wasn't tracked\r\n                user.set('completedLessons', completedLessons, { strict: false });\r\n            }\r\n            // Logic to set next lesson as current\r\n            // Assuming lesson IDs are sequential integers for now based on data/modules.ts\r\n            // If the completed lesson was the current one, move to next\r\n            if (currentLesson === lessonId) {\r\n                user.set('currentLesson', lessonId + 1, { strict: false });\r\n            }\r\n        } else {\r\n            // Just updating current lesson without completion (e.g. started but not finished)\r\n            user.set('currentLesson', lessonId, { strict: false });\r\n        }\r\n\r\n        log('Saving user');\r\n        await user.save();\r\n        log('User saved successfully');\r\n        return NextResponse.json(user);\r\n    } catch (err: any) {\r\n        console.error('Progress Update Error:', err);\r\n        return NextResponse.json({ msg: 'Server error', error: err.message, logs }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}